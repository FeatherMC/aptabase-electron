"use strict";const p=require("electron"),E=require("child_process"),A=require("fs"),N=require("os");var P=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(r,n)=>(typeof require<"u"?require:r)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),f=(e,r,n)=>new Promise((i,u)=>{var s=t=>{try{o(n.next(t))}catch(c){u(c)}},a=t=>{try{o(n.throw(t))}catch(c){u(c)}},o=t=>t.done?i(t.value):Promise.resolve(t.value).then(s,a);o((n=n.apply(e,r)).next())}),q="aptabase-electron@0.3.0";function R(e){return f(this,null,function*(){let[r,n]=yield T();return{appVersion:e.getVersion(),isDebug:!e.isPackaged,locale:e.getLocale(),osName:r,osVersion:n,engineName:"Chromium",engineVersion:process.versions.chrome,sdkVersion:q}})}function T(){return f(this,null,function*(){switch(process.platform){case"win32":return["Windows",N.release()];case"darwin":return["macOS",yield _()];default:return yield I()}})}function _(){return f(this,null,function*(){try{return(yield new Promise((e,r)=>{E.exec("/usr/bin/sw_vers -productVersion",(n,i)=>{if(n){r(n);return}e(i)})})).trim()}catch{return""}})}function I(){return f(this,null,function*(){var e,r;try{let n=(yield new Promise((a,o)=>{A.readFile("/etc/os-release","utf8",(t,c)=>{if(t){o(t);return}a(c)})})).split(`
`),i={};for(let a of n){let[o,t]=a.split("=");o&&t&&(i[o]=t.replace(/"/g,""))}let u=(e=i.NAME)!=null?e:"Linux",s=(r=i.VERSION_ID)!=null?r:"";return[u,s]}catch{return["Linux",""]}})}var h=P("crypto");function b(){return h&&h.randomUUID?h.randomUUID():[d(8),d(4),d(4),d(4),d(12)].join("-")}var V="abcdefghijklmnopqrstuvwxyz0123456789",U=V.length;function d(e){let r="";for(let n=0;n<e;n++)r+=V.charAt(Math.floor(Math.random()*U));return r}var k=1*60*60,g=b(),w=new Date,m="",S="",l,D={US:"https://us.aptabase.com",EU:"https://eu.aptabase.com",DEV:"http://localhost:3000",SH:""};function x(e,r){return f(this,null,function*(){if(p.app.isReady()){console.warn("Aptabase: `initialize` must be invoked before the app is ready. Tracking will be disabled.");return}let n=e.split("-");if(n.length!==3||D[n[1]]===void 0){console.warn(`Aptabase: App Key "${e}" is invalid. Tracking will be disabled.`);return}F(),yield p.app.whenReady(),H(),S=`${L(n[1],r)}/api/v0/event`,l=yield R(p.app),m=e,C()})}var v=[];function y(e,r){if(!m||!l)return v.push({eventName:e,props:r}),Promise.resolve();let n=new Date,i=n.getTime()-w.getTime();Math.floor(i/1e3)>k&&(g=b()),w=n;let u={timestamp:n.toISOString(),sessionId:g,eventName:e,systemProps:{isDebug:l.isDebug,locale:l.locale,osName:l.osName,osVersion:l.osVersion,engineName:l.engineName,engineVersion:l.engineVersion,appVersion:l.appVersion,sdkVersion:l.sdkVersion},props:r};return new Promise(s=>{let a=t=>{console.error("Aptabase: Failed to send event",t),s()},o=p.net.request({method:"POST",url:S,credentials:"omit"});o.setHeader("Content-Type","application/json"),o.setHeader("App-Key",m),o.on("error",a),o.on("abort",a),o.on("response",t=>{t.statusCode>=300&&console.warn(`Aptabase: Failed to send event "${e}": ${t.statusCode} ${t.statusMessage}`),s()}),o.write(JSON.stringify(u)),o.end()})}function C(){for(;v.length>0;){let e=v.shift();e&&y(e.eventName,e.props)}}function F(){p.protocol.registerSchemesAsPrivileged([{scheme:"aptabase-ipc",privileges:{bypassCSP:!0,corsEnabled:!0,supportFetchAPI:!0,secure:!0}}])}function H(){p.protocol.registerStringProtocol("aptabase-ipc",(e,r)=>{var n,i,u;try{let s=(i=(n=e.uploadData)==null?void 0:n[0])==null?void 0:i.bytes,{eventName:a,props:o}=JSON.parse((u=s==null?void 0:s.toString())!=null?u:"{}");y(a,o)}catch(s){console.error("Aptabase: Failed to send event",s)}r("")})}function L(e,r){if(e==="SH"){if(!(r!=null&&r.host)){console.warn("Aptabase: Host parameter must be defined when using Self-Hosted App Key. Tracking will be disabled.");return}return r.host}return D[e]}x("A-DEV-7523634193");p.app.whenReady().then(()=>{y("app_started");const e=new p.BrowserWindow({title:"Main window"});process.env.VITE_DEV_SERVER_URL?(e.loadURL(process.env.VITE_DEV_SERVER_URL),e.webContents.openDevTools()):e.loadFile("dist/index.html")});
