"use strict";var m=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var O=(e,n)=>{for(var t in n)m(e,t,{get:n[t],enumerable:!0})},k=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of I(n))!N.call(e,r)&&r!==t&&m(e,r,{get:()=>n[r],enumerable:!(s=P(n,r))||s.enumerable});return e};var x=e=>k(m({},"__esModule",{value:!0}),e);var u=(e,n,t)=>new Promise((s,r)=>{var c=p=>{try{o(t.next(p))}catch(g){r(g)}},i=p=>{try{o(t.throw(p))}catch(g){r(g)}},o=p=>p.done?s(p.value):Promise.resolve(p.value).then(c,i);o((t=t.apply(e,n)).next())});var K={};O(K,{initialize:()=>U,trackEvent:()=>d});module.exports=x(K);var a=require("electron");var S=require("child_process"),h=require("fs"),w=require("os");var D="aptabase-electron@0.3.1";function v(e){return u(this,null,function*(){let[n,t]=yield _();return{appVersion:e.getVersion(),isDebug:!e.isPackaged,locale:e.getLocale(),osName:n,osVersion:t,engineName:"Chromium",engineVersion:process.versions.chrome,sdkVersion:D}})}function _(){return u(this,null,function*(){switch(process.platform){case"win32":return["Windows",(0,w.release)()];case"darwin":return["macOS",yield R()];default:return yield M()}})}function R(){return u(this,null,function*(){try{return(yield new Promise((n,t)=>{(0,S.exec)("/usr/bin/sw_vers -productVersion",(s,r)=>{if(s){t(s);return}n(r)})})).trim()}catch(e){return""}})}function M(){return u(this,null,function*(){var e,n;try{let s=(yield new Promise((o,p)=>{(0,h.readFile)("/etc/os-release","utf8",(g,E)=>{if(g){p(g);return}o(E)})})).split(`
`),r={};for(let o of s){let[p,g]=o.split("=");p&&g&&(r[p]=g.replace(/"/g,""))}let c=(e=r.NAME)!=null?e:"Linux",i=(n=r.VERSION_ID)!=null?n:"";return[c,i]}catch(t){return["Linux",""]}})}function V(){let e=Math.floor(Date.now()/1e3).toString(),n=Math.floor(Math.random()*1e8).toString().padStart(8,"0");return e+n}var Q=1*60*60,T=V(),H=new Date,f="",y="",l,A={US:"https://us.aptabase.com",EU:"https://eu.aptabase.com",DEV:"http://localhost:3000",SH:""};function U(e,n){return u(this,null,function*(){if(a.app.isReady()){console.warn("Aptabase: `initialize` must be invoked before the app is ready. Tracking will be disabled.");return}let t=e.split("-");if(t.length!==3||A[t[1]]===void 0){console.warn(`Aptabase: App Key "${e}" is invalid. Tracking will be disabled.`);return}$(),yield a.app.whenReady(),C(),y=`${L(t[1],n)}/api/v0/event`,l=yield v(a.app),f=e,F()})}var b=[];function d(e,n){if(!f||!l)return b.push({eventName:e,props:n}),Promise.resolve();let t=new Date;H=t;let s={timestamp:t.toISOString(),sessionId:T,eventName:e,systemProps:{isDebug:l.isDebug,locale:l.locale,osName:l.osName,osVersion:l.osVersion,engineName:l.engineName,engineVersion:l.engineVersion,appVersion:l.appVersion,sdkVersion:l.sdkVersion},props:n};return new Promise(r=>{let c=o=>{console.error("Aptabase: Failed to send event",o),r()},i=a.net.request({method:"POST",url:y,credentials:"omit"});i.setHeader("Content-Type","application/json"),i.setHeader("App-Key",f),i.on("error",c),i.on("abort",c),i.on("response",o=>{o.statusCode>=300&&console.warn(`Aptabase: Failed to send event "${e}": ${o.statusCode} ${o.statusMessage}`),r()}),i.write(JSON.stringify(s)),i.end()})}function F(){for(;b.length>0;){let e=b.shift();e&&d(e.eventName,e.props)}}function $(){a.protocol.registerSchemesAsPrivileged&&a.protocol.registerSchemesAsPrivileged([{scheme:"aptabase-ipc",privileges:{bypassCSP:!0,corsEnabled:!0,supportFetchAPI:!0,secure:!0}}])}function C(){a.ipcMain.on("aptabase:trackEvent",(e,n,t)=>{d(n,t).catch(s=>{console.error("Aptabase: Failed to send event",s)})}),a.protocol.registerStringProtocol&&a.protocol.registerStringProtocol("aptabase-ipc",(e,n)=>{var t,s,r;try{let c=(s=(t=e.uploadData)==null?void 0:t[0])==null?void 0:s.bytes,{eventName:i,props:o}=JSON.parse((r=c==null?void 0:c.toString())!=null?r:"{}");d(i,o)}catch(c){console.error("Aptabase: Failed to send event",c)}n("")})}function L(e,n){if(e==="SH"){if(!(n!=null&&n.host)){console.warn("Aptabase: Host parameter must be defined when using Self-Hosted App Key. Tracking will be disabled.");return}return n.host}return A[e]}0&&(module.exports={initialize,trackEvent});
//# sourceMappingURL=main.cjs.map